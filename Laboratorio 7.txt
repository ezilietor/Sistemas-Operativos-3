Comandos usados practica 1

============================================
Server
sudo dnf install nfs-utils -y | Instala nfs
sudo systemctl enable --now nfs-server | Habilitar el servicio 
sudo systemctl start nfs-server   | Habilitar el servicio 
sudo mkdir /OS3   | Crear el directorio donde estaran los archivos
cd /OS3   | Abrir la carpeta 
sudo touch Adrian{1..100}.txt   | Crear 1000 archivos txt
chmod -R  777 /OS3   | Dar todos los permisos al directorio 
ls /OS3    | Comprobar los archivos dentro del directorio 

sudo nano /etc/exports   | Configurar y montar nfs en la maquina del cliente
-----------------------dentro del archivo------------------------
/OS3 IP_Cliente(rw,sync,no_subtree_check)
------------------------------------------------------------------------
sudo exportfs -ra    | Exportar la montura
sudo exportfs -v   | Exportar 
sudo firewall-cmd --permanent --add-service=nfs    | Habilitar los servicios en el firewall
sudo firewall-cmd --permanent --add-service=mountd
sudo firewall-cmd --permanent --add-service=rpc-bind
sudo firewall-cmd --reload

Cliente
sudo dnf install nfs-utils -y       | Instalar nfs en el cliente
sudo mkdir /mnt/OS3          | Crear el directorio que se sincronizara 
sudo mount IP_Server:/OS3 /mnt/OS3      | Montar el directorio del servidor 
ls /mnt/OS3      | Comprobar los archivos 

-----------------Montaje automatico cliente----------


sudo nano /etc/fstab      | Carpeta para que la montura se haga cada vez que se reinicie la maquina


------dentro del archivo-----
IP_Server:/OS3 /mnt/OS3 nfs defaults 0 0
-------------
sudo mount -a      | Montar todo 
ls /mnt/OS3      | Comprobar los archivos

Reiniciar cliente y luego comprobar 



Comandos usados practica 2

============================================



Seleccionar la carpeta compartida y darle a conectar unidad de red

***************ESTO ES UN SCRIPT QUE PUEDES COPIAR Y PEGAR EN LA TERMINAL************
# 1. Instalación y directorios
sudo dnf install samba samba-client samba-common -y
sudo mkdir -p /srv/samba/adrian

# 2. Usuarios y Grupos
sudo groupadd sambagrupo
sudo useradd -M -s /sbin/nologin adrianuser -G sambagrupo

# 3. Contraseña (TE PEDIRÁ ESCRIBIRLA AQUÍ)
sudo smbpasswd -a adrianuser
sudo smbpasswd -e adrianuser

# 4. Permisos y archivos de prueba
sudo chown -R adrianuser:sambagrupo /srv/samba/adrian
sudo chmod -R 777 /srv/samba/adrian
cd /srv/samba/adrian
touch adrian{1..100}.txt

# 5. Inyectar configuración en smb.conf (Sin usar Nano)
sudo bash -c 'cat >> /etc/samba/smb.conf <<EOF

[AdrianShare]
        path = /srv/samba/adrian
        writable = yes
        read only = no
        browseable = yes
        valid users = adrianuser
        create mask = 0755
        directory mask = 0755
EOF'

# 6. Seguridad y Red
sudo setenforce 0
sudo setsebool -P samba_export_all_rw on
sudo systemctl restart smb
sudo firewall-cmd --permanent --add-service=samba
sudo firewall-cmd --reload

# 7. Mostrar IP para conectar
hostname -I

-----------------------------EN EL WINDOWS-----------------------------
# 1. Borrar cualquier registro anterior o cache
net use * /delete

# 2. Usar Win + R 
\\IP_QUE_SALIO_EN_LINUX

# 3. Credenciales
Usuario: adrianuser
Contraseña: La_que_pusiste_aqui


Comandos usados practica 3

============================================
# Descargar git 
sudo dnf install git -y 

#Instalar los plugins para dnf
 sudo dnf -y install dnf-plugins-core
sudo dnf config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo

#Instalar Docker Engine
sudo dnf install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

#Iniciar Docker Engine
sudo systemctl enable --now docker

#Liberar el puerto para el DNS de Samba
sudo systemctl stop firewalld
sudo systemctl disable firewalld
sudo systemctl stop systemd-resolved
sudo systemctl disable systemd-resolved

#Asegurar dns temporal para que el host tenga internet
sudo unlink /etc/resolv.conf
echo "nameserver 8.8.8.8" | sudo tee /etc/resolv.conf

#Correr el servicio de docker
docker run -d \
  --name samba-dc \
  --hostname dc1 \
  --domainname so3.inet \
  --network host \
  --privileged \
  -v samba_data:/var/lib/samba \
  -v /etc/localtime:/etc/localtime:ro \
  ubuntu:latest \
  tail -f /dev/null

#Entrar al contenedor 
sudo docker exec -it samba-dc /bin/bash

#Instalar samba y actualizar herramientas
apt-get update
DEBIAN_FRONTEND=noninteractive apt-get install -y samba krb5-config winbind smbclient iproute2

#Ejecutar el comando de provision y borrar cualquier configuracion previa
rm /etc/samba/smb.conf
rm -rf /var/lib/samba/private/*


#Ejecutar el controlador del dominio y aseguirar que tenga la IP de CentOS
samba-tool domain provision \
--use-rfc2307 \
--realm=SO3.INET \
--domain=SO3 \
--server-role=dc \
--dns-backend=SAMBA_INTERNAL \
--adminpass="Admin1234!" \
--option="dns forwarder = 8.8.8.8" \
--host-ip=MiIPCentOS

#Antes de crear usuario para contraseña
samba-tool domain passwordsettings set --complexity=off
samba-tool domain passwordsettings set --min-pwd-length=6
samba-tool domain passwordsettings set --max-pwd-age=0

#Copiar el kerberos
cp /var/lib/samba/private/krb5.conf /etc/krb5.conf

#DNS temporal para el contenedor
echo "nameserver 127.0.0.1" > /etc/resolv.conf

#Crear usuario 
useradd lanegracubana

#AÑAdir el usuario al Windows
samba-tool user create lanegracubana matricula

#arrancar samba 
samba -D



En Windows 

#Configurar el dns con la IP de mi maquina de CentOS 

#Verificacion de que todo esta bien 
nslookup so3.inet

#En el cmd ejecutar 
ping so3.inet


#En el windows
el Dominio: SO3.inet
Usuario: Administrator
contraseña: Admin1234!

En pantalla de bloqueo 
Usuario: lanegracubana
contraseña: matricula

